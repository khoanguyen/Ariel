<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 45. AJAX Client</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="RESTEasy JAX-RS"/><link rel="up" href="index.html" title="RESTEasy JAX-RS"/><link rel="prev" href="RESTEasy_Client_Framework.html" title="Chapter 44. Client Framework"/><link rel="next" href="Maven_and_RESTEasy.html" title="Chapter 46. Maven and RESTEasy"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="RESTEasy_Client_Framework.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="Maven_and_RESTEasy.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="AJAX_Client"/>Chapter 45. AJAX Client</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="AJAX_Client.html#d0e3371">45.1. Generated JavaScript API</a></span></dt><dd><dl><dt><span class="section"><a href="AJAX_Client.html#d0e3387">45.1.1. JavaScript API servlet</a></span></dt><dt><span class="section"><a href="AJAX_Client.html#d0e3394">45.1.2. JavaScript API usage</a></span></dt><dt><span class="section"><a href="AJAX_Client.html#d0e3515">45.1.3. MIME types and unmarshalling.</a></span></dt><dt><span class="section"><a href="AJAX_Client.html#d0e3568">45.1.4. MIME types and marshalling.</a></span></dt></dl></dd><dt><span class="section"><a href="AJAX_Client.html#d0e3633">45.2. Using the JavaScript API to build AJAX queries</a></span></dt><dd><dl><dt><span class="section"><a href="AJAX_Client.html#d0e3638">45.2.1. The REST object</a></span></dt><dt><span class="section"><a href="AJAX_Client.html#d0e3679">45.2.2. The REST.Request class</a></span></dt></dl></dd></dl></div><p>RESTEasy resources can be accessed in JavaScript using AJAX using a 
      proxy API generated by RESTEasy.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3371"/>45.1. Generated JavaScript API</h2></div></div></div><p>
    		RESTEasy can generate a JavaScript API that uses AJAX calls to invoke JAX-RS operations.
    	</p><div class="example"><a id="d0e3376"/><p class="title"><b>Example 45.1. First JAX-RS JavaScript API example</b></p><div class="example-contents"><p>
    			Let's take a simple JAX-RS API:
	    	</p><pre class="programlisting">@Path("orders")
public interface Orders {
 @Path("{id}")
 @GET
 public String getOrder(@PathParam("id") String id){
  return "Hello "+id;
 }
}</pre><p>
				The preceding API would be accessible using the following JavaScript code:
	    	</p><pre class="programlisting">var order = Orders.getOrder({id: 23});</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3387"/>45.1.1. JavaScript API servlet</h3></div></div></div><p>
    			In order to enable the JavaScript API servlet you must configure it in your
    			web.xml file as such:
    		</p><pre class="programlisting">&lt;servlet&gt;
 &lt;servlet-name&gt;RESTEasy JSAPI&lt;/servlet-name&gt;
 &lt;servlet-class&gt;org.jboss.resteasy.jsapi.JSAPIServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
 &lt;servlet-name&gt;RESTEasy JSAPI&lt;/servlet-name&gt;
 &lt;url-pattern&gt;/rest-js&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3394"/>45.1.2. JavaScript API usage</h3></div></div></div><p>
    			Each JAX-RS resource class will generate a JavaScript object of the same name
    			as the declaring class (or interface), which will contain every JAX-RS method
    			as properties.
    		</p><div class="example"><a id="d0e3399"/><p class="title"><b>Example 45.2. Structure of JAX-RS generated JavaScript</b></p><div class="example-contents"><p>For example, if the JAX-RS resource X defines methods Y and Z:
    			</p><pre class="programlisting">@Path("/")
public interface X{
 @GET
 public String Y();
 @PUT
 public void Z(String entity);
}</pre><p>
	    			Then the JavaScript API will define the following functions:
    			</p><pre class="programlisting">var X = {
 Y : function(params){…},
 Z : function(params){…}
};</pre></div></div><br class="example-break"/><p>
				Each JavaScript API method takes an optional object as single
				parameter where each property is a cookie, header, path, query or form parameter as identified
				by their name, or the following special parameters:
    		</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The following special parameter names are subject to change.</p></div><table xmlns="" id="d0e3415"><caption>Table 45.1. API parameter properties</caption><thead><tr>
						<th>Property name</th>
						<th>Default</th>
						<th>Description</th>
					</tr></thead><tbody><tr>
						<td>$entity</td>
						<td/>
						<td>The entity to send as a PUT, POST request.</td>
					</tr><tr>
						<td>$contentType</td>
						<td>As determined by @Consumes.</td>
						<td>The MIME type of the body entity sent as the Content-Type header.</td>
					</tr><tr>
						<td>$accepts</td>
						<td>Determined by @Provides, defaults to */*.</td>
						<td>The accepted MIME types sent as the Accept header.</td>
					</tr><tr>
						<td>$callback</td>
						<td/>
						<td>
							Set to a function(httpCode, xmlHttpRequest, value) for an asynchronous call. If 
							not present, the call will be synchronous and return the value.
						</td>
					</tr><tr>
						<td>$apiURL</td>
						<td>Determined by container</td>
						<td>Set to the base URI of your JAX-RS endpoint, not including the last slash.</td>
					</tr><tr>
						<td>$username</td>
						<td/>
						<td>If username and password are set, they will be used for credentials for the request.</td>
					</tr><tr>
						<td>$password</td>
						<td/>
						<td>If username and password are set, they will be used for credentials for the request.</td>
					</tr></tbody></table><div class="example"><a id="d0e3504"/><p class="title"><b>Example 45.3. Using the API</b></p><div class="example-contents"><p>Here is an example of JAX-RS API:</p><pre class="programlisting">@Path("foo")
public class Foo{
 @Path("{id}")
 @GET
 public String get(@QueryParam("order") String order, @HeaderParam("X-Foo") String header,
                   @MatrixParam("colour") String colour, @CookieParam("Foo-Cookie") String cookie){
  …
 }
 @POST
 public void post(String text){
 }
}</pre><p>We can use the previous JAX-RS API in JavaScript using the following code:</p><pre class="programlisting">
var text = Foo.get({order: 'desc', 'X-Foo': 'hello',
                    colour: 'blue', 'Foo-Cookie': 123987235444});
Foo.put({$entity: text});</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3515"/>45.1.3. MIME types and unmarshalling.</h3></div></div></div><p>
    			The Accept header sent by any client JavaScript function is controlled by the $accepts parameter, which overrides
    			the @Produces annotation on the JAX-RS endpoint. The returned value however is controlled by the Content-Type header
    			sent in the response as follows:
    		</p><table xmlns="" id="d0e3520"><caption>Table 45.2. Return values by MIME type</caption><thead><tr>
						<th>MIME</th>
						<th>Description</th>
					</tr></thead><tbody><tr>
						<td>text/xml,application/xml,application/*+xml</td>
						<td>
							The response entity is parsed as XML before being returned. The return value is thus a DOM Document.
						</td>
					</tr><tr>
						<td>application/json</td>
						<td>
							The response entity is parsed as JSON before being returned. The return value is thus a JavaScript Object.
						</td>
					</tr><tr>
						<td>Anything else</td>
						<td>The response entity is returned raw.</td>
					</tr></tbody></table><div class="example"><a id="d0e3557"/><p class="title"><b>Example 45.4. Unmarshalling example</b></p><div class="example-contents"><p>
	    			The RESTEasy JavaScript client API can automatically unmarshall JSON and XML:
	    		</p><pre class="programlisting">@Path("orders")
public interface Orders {

 @XmlRootElement
 public static class Order {
  @XmlElement
  private String id;
  
  public Order(){}
  
  public Order(String id){
   this.id = id;
  }
 }

 @Path("{id}/xml")
 @GET
 @Produces("application/xml")
 public Order getOrderXML(@PathParam("id") String id){
  return new Order(id);
 }

 @Path("{id}/json")
 @GET
 @Produces("application/json")
 public Order getOrderJSON(@PathParam("id") String id){
  return new Order(id);
 }
}</pre><p>
					Let us look at what the preceding JAX-RS API would give us on the client side:
	    		</p><pre class="programlisting">// this returns a JSON object
var orderJSON = Orders.getOrderJSON({id: "23"});
orderJSON.id == "23";

// this one returns a DOM Document whose root element is the order, with one child (id)
// whose child is the text node value
var orderXML = Orders.getOrderXML({id: "23"});
orderXML.documentElement.childNodes[0].childNodes[0].nodeValue == "23";</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3568"/>45.1.4. MIME types and marshalling.</h3></div></div></div><p>
    			The Content-Type header sent in the request is controlled by the $contentType parameter which overrides the
    			@Consumes annotation on the JAX-RS endpoint. The value passed as entity body using the $entity parameter is marshalled
    			according to both its type and content type:
    		</p><table xmlns="" id="d0e3573"><caption>Table 45.3. Controlling sent entities</caption><thead><tr>
						<th>Type</th>
						<th>MIME</th>
						<th>Description</th>
					</tr></thead><tbody><tr>
						<td>DOM Element</td>
						<td>Empty or text/xml,application/xml,application/*+xml</td>
						<td>The DOM Element is marshalled to XML before being sent.</td>
					</tr><tr>
						<td>JavaScript Object (JSON)</td>
						<td>Empty or application/json</td>
						<td>The JSON object is marshalled to a JSON string before being sent.</td>
					</tr><tr>
						<td>Anything else</td>
						<td>Anything else</td>
						<td>
							The entity is sent as is.
						</td>
					</tr></tbody></table><div class="example"><a id="d0e3622"/><p class="title"><b>Example 45.5. Marshalling example</b></p><div class="example-contents"><p>
	    			The RESTEasy JavaScript client API can automatically marshall JSON and XML:
	    		</p><pre class="programlisting">@Path("orders")
public interface Orders {

 @XmlRootElement
 public static class Order {
  @XmlElement
  private String id;
  
  public Order(){}
  
  public Order(String id){
   this.id = id;
  }
 }

 @Path("{id}/xml")
 @PUT
 @Consumes("application/xml")
 public void putOrderXML(Order order){
  // store order
 }

 @Path("{id}/json")
 @PUT
 @Consumes("application/json")
 public void putOrderJSON(Order order){
  // store order
 }
}</pre><p>
					Let us look at what the preceding JAX-RS API would give us on the client side:
	    		</p><pre class="programlisting">// this saves a JSON object
Orders.putOrderJSON({$entity: {id: "23"}});

// It is a bit more work with XML
var order = document.createElement("order");
var id = document.createElement("id");
order.appendChild(id);
id.appendChild(document.createTextNode("23"));
Orders.putOrderXML({$entity: order});</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3633"/>45.2. Using the JavaScript API to build AJAX queries</h2></div></div></div><p>
   			The RESTEasy JavaScript API can also be used to manually construct your requests.
   		</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3638"/>45.2.1. The REST object</h3></div></div></div><p>
   				The REST object contains the following read-write properties:
   			</p><table xmlns="" id="d0e3643"><caption>Table 45.4. The REST object</caption><thead><tr>
						<th>Property</th>
						<th>Description</th>
					</tr></thead><tbody><tr>
						<td>apiURL</td>
						<td>
							Set by default to the JAX-RS root URL, used by every JavaScript client API functions when constructing
							the requests.
						</td>
					</tr><tr>
						<td>log</td>
						<td>
							Set to a function(string) in order to receive RESTEasy client API logs. This is useful if you want to
							debug your client API and place the logs where you can see them.
						</td>
					</tr></tbody></table><div class="example"><a id="d0e3672"/><p class="title"><b>Example 45.6. Using the REST object</b></p><div class="example-contents"><p>
	    			The REST object can be used to override RESTEasy JavaScript API client behaviour:
	    		</p><pre class="programlisting">// Change the base URL used by the API:
REST.apiURL = "http://api.service.com";

// log everything in a div element
REST.log = function(text){
 jQuery("#log-div").append(text);
};</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3679"/>45.2.2. The REST.Request class</h3></div></div></div><p>
   				The REST.Request class is used to build custom requests. It has the following members: 
   			</p><table xmlns="" id="d0e3684"><caption>Table 45.5. The REST.Request class</caption><thead><tr>
						<th>Member</th>
						<th>Description</th>
					</tr></thead><tbody><tr>
						<td>execute(callback)</td>
						<td>
							Executes the request with all the information set in the current object. The value is never returned
							but passed to the optional argument callback.
						</td>
					</tr><tr>
						<td>setAccepts(acceptHeader)</td>
						<td>
							Sets the Accept request header. Defaults to */*.
						</td>
					</tr><tr>
						<td>setCredentials(username, password)</td>
						<td>
							Sets the request credentials.
						</td>
					</tr><tr>
						<td>setEntity(entity)</td>
						<td>
							Sets the request entity.
						</td>
					</tr><tr>
						<td>setContentType(contentTypeHeader)</td>
						<td>
							Sets the Content-Type request header.
						</td>
					</tr><tr>
						<td>setURI(uri)</td>
						<td>
							Sets the request URI. This should be an absolute URI.
						</td>
					</tr><tr>
						<td>setMethod(method)</td>
						<td>
							Sets the request method. Defaults to GET.
						</td>
					</tr><tr>
						<td>setAsync(async)</td>
						<td>
							Controls whether the request should be asynchronous. Defaults to true.
						</td>
					</tr><tr>
						<td>addCookie(name, value)</td>
						<td>
							Sets the given cookie in the current document when executing the request.
							Beware that this will be persistent in your browser.
						</td>
					</tr><tr>
						<td>addQueryParameter(name, value)</td>
						<td>
							Adds a query parameter to the URI query part.
						</td>
					</tr><tr>
						<td>addMatrixParameter(name, value)</td>
						<td>
							Adds a matrix parameter (path parameter) to the last path segment of the request URI.
						</td>
					</tr><tr>
						<td>addHeader(name, value)</td>
						<td>
							Adds a request header.
						</td>
					</tr></tbody></table><div class="example"><a id="d0e3793"/><p class="title"><b>Example 45.7. Using the REST.Request class</b></p><div class="example-contents"><p>
	    			The REST.Request class can be used to build custom requests:
	    		</p><pre class="programlisting">var r = new REST.Request();
r.setURI("http://api.service.com/orders/23/json");
r.setMethod("PUT");
r.setContentType("application/json");
r.setEntity({id: "23"});
r.addMatrixParameter("JSESSIONID", "12309812378123");
r.execute(function(status, request, entity){
 log("Response is "+status);
});</pre></div></div><br class="example-break"/></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="RESTEasy_Client_Framework.html"><strong>Prev</strong>Chapter 44. Client Framework</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="Maven_and_RESTEasy.html"><strong>Next</strong>Chapter 46. Maven and RESTEasy</a></li></ul></body></html>